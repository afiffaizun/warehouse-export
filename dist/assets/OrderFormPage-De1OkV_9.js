import{d as L,a as n,b as t,p as f,j as m,g as c,z as h,F as g,s as x,t as l,f as F,x as P,v as k,w as $,r as N,m as p,k as A,o as r}from"./index-czusdGKy.js";import{i as E,m as B}from"./order-ClBenP9t.js";import{m as V}from"./pelanggan-DRJWW-Qu.js";import{m as T}from"./barang-CFxOeyqE.js";import{A as R}from"./arrow-left-niwPLKv0.js";import{P as z}from"./plus-B6EcQOpU.js";import{S as J}from"./save-BtIu_2VS.js";import{T as K}from"./trash-2-DtEKhdmy.js";const Y={class:"space-y-6"},G={class:"flex items-center gap-4"},H={class:"lg:col-span-2 space-y-6"},Q={class:"card p-6"},W={class:"form-group"},X=["value"],Z={key:0,class:"mt-4 p-4 bg-background-tertiary rounded-lg"},tt={class:"grid grid-cols-2 gap-4 text-sm"},et={class:"font-medium"},st={class:"font-medium"},ot={class:"font-medium"},at={class:"font-medium"},lt={class:"card p-6"},nt={class:"flex items-center justify-between mb-4"},rt={class:"space-y-4"},it={class:"flex items-start gap-4"},dt={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4"},ut={class:"form-group"},mt=["onUpdate:modelValue"],ct=["value"],pt={class:"form-group"},vt=["onUpdate:modelValue"],bt={class:"form-group"},yt={class:"input bg-slate-100 text-text-muted"},ft=["onClick","disabled"],gt={class:"card p-6"},xt={class:"space-y-6"},_t={class:"card p-6"},ht={class:"form-group"},kt=["value"],It={class:"card p-6"},wt={class:"space-y-3"},St={class:"flex justify-between"},Ut={class:"font-medium"},Ct={class:"flex justify-between items-center"},Pt={class:"flex justify-between items-center"},Nt={class:"text-text-secondary"},Bt={class:"font-medium"},Vt={class:"border-t border-border pt-3"},Tt={class:"flex justify-between"},qt={class:"font-bold text-lg text-accent-primary"},Mt={class:"card p-6"},Ot={class:"space-y-3"},jt=["disabled"],Kt=L({__name:"OrderFormPage",setup(Dt){const I=A(),b=N(!1),o=N({buyerId:"",items:[{productId:"",quantity:1}],incoterms:"fob",shippingCostUsd:0,taxPercent:10,notes:""}),d=p(()=>V.find(a=>a.id===Number(o.value.buyerId))),w=p(()=>T.filter(a=>a.status==="aktif")),S=p(()=>o.value.items.filter(a=>a.productId).map((a,e)=>{const s=T.find(u=>u.id===Number(a.productId));return{id:e+1,productId:Number(a.productId),productName:s?.name||"",productSku:s?.sku||"",quantity:a.quantity,unit:s?.unit||"PCS",priceUsd:s?.priceUsd||0,totalUsd:(s?.priceUsd||0)*a.quantity}})),y=p(()=>S.value.reduce((a,e)=>a+e.totalUsd,0)),_=p(()=>y.value*(o.value.taxPercent/100)),U=p(()=>y.value+o.value.shippingCostUsd+_.value),q=()=>{const a=new Date,e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),u=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`SO-${e}${s}-${u}`},M=()=>{o.value.items.push({productId:"",quantity:1})},O=a=>{o.value.items.length>1&&o.value.items.splice(a,1)},j=a=>w.value.find(e=>e.id===Number(a)),C=()=>{I.back()},D=async()=>{if(!o.value.buyerId){alert("Mohon pilih buyer");return}if(o.value.items.filter(e=>e.productId&&e.quantity>0).length===0){alert("Mohon tambahkan minimal 1 item");return}b.value=!0;try{await new Promise(s=>setTimeout(s,500));const e=Math.max(...B.map(s=>s.id))+1;B.unshift({id:e,orderNumber:q(),buyerId:Number(o.value.buyerId),buyerName:d.value?.companyName||"",buyerCountry:d.value?.country||"",items:S.value,subtotalUsd:y.value,shippingCostUsd:o.value.shippingCostUsd,taxUsd:_.value,totalUsd:U.value,incoterms:o.value.incoterms,status:"draft",paymentStatus:"unpaid",notes:o.value.notes,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),I.push({name:"order"})}catch(e){console.error("Error saving order:",e)}finally{b.value=!1}},v=a=>`$${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`;return(a,e)=>(r(),n("div",Y,[t("div",G,[t("button",{onClick:C,class:"btn-icon btn-ghost"},[f(m(R),{class:"w-5 h-5"})]),e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Buat Order Baru"),t("p",{class:"text-text-secondary mt-1"},"Buat sales order ekspor baru")],-1))]),t("form",{onSubmit:$(D,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[t("div",H,[t("div",Q,[e[11]||(e[11]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Informasi Buyer",-1)),t("div",W,[e[6]||(e[6]=t("label",{class:"label label-required"},"Pilih Buyer",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.buyerId=s),class:"select"},[e[5]||(e[5]=t("option",{value:""},"Pilih Buyer",-1)),(r(!0),n(g,null,x(m(V),s=>(r(),n("option",{key:s.id,value:s.id},l(s.companyName)+" ("+l(s.country)+") ",9,X))),128))],512),[[h,o.value.buyerId]])]),d.value?(r(),n("div",Z,[t("div",tt,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-text-muted"},"Kontak",-1)),t("p",et,l(d.value.contactPerson),1)]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-text-muted"},"Email",-1)),t("p",st,l(d.value.email),1)]),t("div",null,[e[9]||(e[9]=t("p",{class:"text-text-muted"},"Credit Limit",-1)),t("p",ot,l(v(d.value.creditLimit)),1)]),t("div",null,[e[10]||(e[10]=t("p",{class:"text-text-muted"},"Payment Terms",-1)),t("p",at,l(d.value.paymentTerms),1)])])])):F("",!0)]),t("div",lt,[t("div",nt,[e[13]||(e[13]=t("h2",{class:"font-semibold text-text-primary"},"Item Order",-1)),t("button",{type:"button",onClick:M,class:"btn-outline btn-sm"},[f(m(z),{class:"w-4 h-4"}),e[12]||(e[12]=P(" Tambah Item ",-1))])]),t("div",rt,[(r(!0),n(g,null,x(o.value.items,(s,u)=>(r(),n("div",{key:u,class:"p-4 bg-background-tertiary rounded-lg"},[t("div",it,[t("div",dt,[t("div",ut,[e[15]||(e[15]=t("label",{class:"label"},"Produk",-1)),c(t("select",{"onUpdate:modelValue":i=>s.productId=i,class:"select"},[e[14]||(e[14]=t("option",{value:""},"Pilih Produk",-1)),(r(!0),n(g,null,x(w.value,i=>(r(),n("option",{key:i.id,value:i.id},l(i.name)+" ("+l(i.sku)+") ",9,ct))),128))],8,mt),[[h,s.productId]])]),t("div",pt,[e[16]||(e[16]=t("label",{class:"label"},"Jumlah",-1)),c(t("input",{"onUpdate:modelValue":i=>s.quantity=i,type:"number",min:"1",class:"input",placeholder:"0"},null,8,vt),[[k,s.quantity,void 0,{number:!0}]])]),t("div",bt,[e[17]||(e[17]=t("label",{class:"label"},"Subtotal",-1)),t("div",yt,l(v((j(s.productId)?.priceUsd||0)*s.quantity)),1)])]),t("button",{type:"button",onClick:i=>O(u),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50 mt-6"},[f(m(K),{class:"w-4 h-4"})],8,ft)])]))),128))])]),t("div",gt,[e[18]||(e[18]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),c(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.notes=s),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[k,o.value.notes]])])]),t("div",xt,[t("div",_t,[e[19]||(e[19]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Incoterms",-1)),t("div",ht,[c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.incoterms=s),class:"select"},[(r(!0),n(g,null,x(m(E),s=>(r(),n("option",{key:s.value,value:s.value},l(s.label),9,kt))),128))],512),[[h,o.value.incoterms]])])]),t("div",It,[e[23]||(e[23]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),t("div",wt,[t("div",St,[e[20]||(e[20]=t("span",{class:"text-text-secondary"},"Subtotal",-1)),t("span",Ut,l(v(y.value)),1)]),t("div",Ct,[e[21]||(e[21]=t("span",{class:"text-text-secondary"},"Shipping",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.shippingCostUsd=s),type:"number",class:"input w-24 text-right",placeholder:"0"},null,512),[[k,o.value.shippingCostUsd,void 0,{number:!0}]])]),t("div",Pt,[t("span",Nt,"Tax ("+l(o.value.taxPercent)+"%)",1),t("span",Bt,l(v(_.value)),1)]),t("div",Vt,[t("div",Tt,[e[22]||(e[22]=t("span",{class:"font-semibold"},"Total",-1)),t("span",qt,l(v(U.value)),1)])])])]),t("div",Mt,[t("div",Ot,[t("button",{type:"submit",disabled:b.value,class:"btn-primary w-full"},[f(m(J),{class:"w-4 h-4"}),P(" "+l(b.value?"Menyimpan...":"Simpan Order"),1)],8,jt),t("button",{type:"button",onClick:C,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{Kt as default};
