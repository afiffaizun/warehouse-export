import{d as A,B as F,a as n,b as t,p as f,j as m,g as c,A as k,F as g,s as x,t as l,f as $,x as N,v as I,w as E,r as B,m as p,k as R,o as r}from"./index-CUmndf2P.js";import{i as J,m as T}from"./order-ClBenP9t.js";import{m as V}from"./pelanggan-DRJWW-Qu.js";import{m as q}from"./barang-CFxOeyqE.js";import{A as K}from"./arrow-left-Cpmr9AlM.js";import{P as Y}from"./plus-BEll3Vn4.js";import{S as z}from"./save-B4hMgu_F.js";import{T as G}from"./trash-2-BAvBQP-f.js";const H={class:"space-y-6"},Q={class:"flex items-center gap-4"},W={class:"lg:col-span-2 space-y-6"},X={class:"card p-6"},Z={class:"form-group"},tt=["value"],et={key:0,class:"mt-4 p-4 bg-background-tertiary rounded-lg"},st={class:"grid grid-cols-2 gap-4 text-sm"},ot={class:"font-medium"},at={class:"font-medium"},lt={class:"font-medium"},nt={class:"font-medium"},rt={class:"card p-6"},it={class:"flex items-center justify-between mb-4"},dt={class:"space-y-4"},ut={class:"flex items-start gap-4"},mt={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4"},ct={class:"form-group"},pt=["onUpdate:modelValue"],vt=["value"],bt={class:"form-group"},yt=["onUpdate:modelValue"],ft={class:"form-group"},gt={class:"input bg-slate-100 text-text-muted"},xt=["onClick","disabled"],ht={class:"card p-6"},_t={class:"space-y-6"},kt={class:"card p-6"},It={class:"form-group"},St=["value"],wt={class:"card p-6"},Ut={class:"space-y-3"},Ct={class:"flex justify-between"},Pt={class:"font-medium"},Nt={class:"flex justify-between items-center"},Bt={class:"flex justify-between items-center"},Tt={class:"text-text-secondary"},Vt={class:"font-medium"},qt={class:"border-t border-border pt-3"},Mt={class:"flex justify-between"},Ot={class:"font-bold text-lg text-accent-primary"},jt={class:"card p-6"},Dt={class:"space-y-3"},Lt=["disabled"],Gt=A({__name:"OrderFormPage",setup(At){const S=R(),h=F(),b=B(!1),o=B({buyerId:"",items:[{productId:"",quantity:1}],incoterms:"fob",shippingCostUsd:0,taxPercent:10,notes:""}),d=p(()=>V.find(a=>a.id===Number(o.value.buyerId))),w=p(()=>q.filter(a=>a.status==="aktif")),U=p(()=>o.value.items.filter(a=>a.productId).map((a,e)=>{const s=q.find(u=>u.id===Number(a.productId));return{id:e+1,productId:Number(a.productId),productName:s?.name||"",productSku:s?.sku||"",quantity:a.quantity,unit:s?.unit||"PCS",priceUsd:s?.priceUsd||0,totalUsd:(s?.priceUsd||0)*a.quantity}})),y=p(()=>U.value.reduce((a,e)=>a+e.totalUsd,0)),_=p(()=>y.value*(o.value.taxPercent/100)),C=p(()=>y.value+o.value.shippingCostUsd+_.value),M=()=>{const a=new Date,e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),u=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`SO-${e}${s}-${u}`},O=()=>{o.value.items.push({productId:"",quantity:1})},j=a=>{o.value.items.length>1&&o.value.items.splice(a,1)},D=a=>w.value.find(e=>e.id===Number(a)),P=()=>{S.back()},L=async()=>{if(!o.value.buyerId){h.error("Mohon pilih buyer");return}if(o.value.items.filter(e=>e.productId&&e.quantity>0).length===0){h.error("Mohon tambahkan minimal 1 item");return}b.value=!0;try{await new Promise(s=>setTimeout(s,500));const e=Math.max(...T.map(s=>s.id))+1;T.unshift({id:e,orderNumber:M(),buyerId:Number(o.value.buyerId),buyerName:d.value?.companyName||"",buyerCountry:d.value?.country||"",items:U.value,subtotalUsd:y.value,shippingCostUsd:o.value.shippingCostUsd,taxUsd:_.value,totalUsd:C.value,incoterms:o.value.incoterms,status:"draft",paymentStatus:"unpaid",notes:o.value.notes,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),h.success("Order berhasil dibuat!"),S.push({name:"order"})}catch(e){console.error("Error saving order:",e)}finally{b.value=!1}},v=a=>`$${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`;return(a,e)=>(r(),n("div",H,[t("div",Q,[t("button",{onClick:P,class:"btn-icon btn-ghost"},[f(m(K),{class:"w-5 h-5"})]),e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Buat Order Baru"),t("p",{class:"text-text-secondary mt-1"},"Buat sales order ekspor baru")],-1))]),t("form",{onSubmit:E(L,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[t("div",W,[t("div",X,[e[11]||(e[11]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Informasi Buyer",-1)),t("div",Z,[e[6]||(e[6]=t("label",{class:"label label-required"},"Pilih Buyer",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.buyerId=s),class:"select"},[e[5]||(e[5]=t("option",{value:""},"Pilih Buyer",-1)),(r(!0),n(g,null,x(m(V),s=>(r(),n("option",{key:s.id,value:s.id},l(s.companyName)+" ("+l(s.country)+") ",9,tt))),128))],512),[[k,o.value.buyerId]])]),d.value?(r(),n("div",et,[t("div",st,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-text-muted"},"Kontak",-1)),t("p",ot,l(d.value.contactPerson),1)]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-text-muted"},"Email",-1)),t("p",at,l(d.value.email),1)]),t("div",null,[e[9]||(e[9]=t("p",{class:"text-text-muted"},"Credit Limit",-1)),t("p",lt,l(v(d.value.creditLimit)),1)]),t("div",null,[e[10]||(e[10]=t("p",{class:"text-text-muted"},"Payment Terms",-1)),t("p",nt,l(d.value.paymentTerms),1)])])])):$("",!0)]),t("div",rt,[t("div",it,[e[13]||(e[13]=t("h2",{class:"font-semibold text-text-primary"},"Item Order",-1)),t("button",{type:"button",onClick:O,class:"btn-outline btn-sm"},[f(m(Y),{class:"w-4 h-4"}),e[12]||(e[12]=N(" Tambah Item ",-1))])]),t("div",dt,[(r(!0),n(g,null,x(o.value.items,(s,u)=>(r(),n("div",{key:u,class:"p-4 bg-background-tertiary rounded-lg"},[t("div",ut,[t("div",mt,[t("div",ct,[e[15]||(e[15]=t("label",{class:"label"},"Produk",-1)),c(t("select",{"onUpdate:modelValue":i=>s.productId=i,class:"select"},[e[14]||(e[14]=t("option",{value:""},"Pilih Produk",-1)),(r(!0),n(g,null,x(w.value,i=>(r(),n("option",{key:i.id,value:i.id},l(i.name)+" ("+l(i.sku)+") ",9,vt))),128))],8,pt),[[k,s.productId]])]),t("div",bt,[e[16]||(e[16]=t("label",{class:"label"},"Jumlah",-1)),c(t("input",{"onUpdate:modelValue":i=>s.quantity=i,type:"number",min:"1",class:"input",placeholder:"0"},null,8,yt),[[I,s.quantity,void 0,{number:!0}]])]),t("div",ft,[e[17]||(e[17]=t("label",{class:"label"},"Subtotal",-1)),t("div",gt,l(v((D(s.productId)?.priceUsd||0)*s.quantity)),1)])]),t("button",{type:"button",onClick:i=>j(u),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50 mt-6"},[f(m(G),{class:"w-4 h-4"})],8,xt)])]))),128))])]),t("div",ht,[e[18]||(e[18]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),c(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.notes=s),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[I,o.value.notes]])])]),t("div",_t,[t("div",kt,[e[19]||(e[19]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Incoterms",-1)),t("div",It,[c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.incoterms=s),class:"select"},[(r(!0),n(g,null,x(m(J),s=>(r(),n("option",{key:s.value,value:s.value},l(s.label),9,St))),128))],512),[[k,o.value.incoterms]])])]),t("div",wt,[e[23]||(e[23]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),t("div",Ut,[t("div",Ct,[e[20]||(e[20]=t("span",{class:"text-text-secondary"},"Subtotal",-1)),t("span",Pt,l(v(y.value)),1)]),t("div",Nt,[e[21]||(e[21]=t("span",{class:"text-text-secondary"},"Shipping",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.shippingCostUsd=s),type:"number",class:"input w-24 text-right",placeholder:"0"},null,512),[[I,o.value.shippingCostUsd,void 0,{number:!0}]])]),t("div",Bt,[t("span",Tt,"Tax ("+l(o.value.taxPercent)+"%)",1),t("span",Vt,l(v(_.value)),1)]),t("div",qt,[t("div",Mt,[e[22]||(e[22]=t("span",{class:"font-semibold"},"Total",-1)),t("span",Ot,l(v(C.value)),1)])])])]),t("div",jt,[t("div",Dt,[t("button",{type:"submit",disabled:b.value,class:"btn-primary w-full"},[f(m(z),{class:"w-4 h-4"}),N(" "+l(b.value?"Menyimpan...":"Simpan Order"),1)],8,Lt),t("button",{type:"button",onClick:P,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{Gt as default};
