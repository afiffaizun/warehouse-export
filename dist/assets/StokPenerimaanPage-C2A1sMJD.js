import{d as C,a as d,b as e,p as m,j as u,P as U,f as B,x as P,F as f,s as g,g as c,v as b,t as i,w as j,r as x,k as R,z as $,D as A,m as E,o as r}from"./index-CVldBSkh.js";import{m as v}from"./barang-CFxOeyqE.js";import{w as y,a as T,m as _}from"./stok-o4hf6QBl.js";import{A as G}from"./arrow-left-Dw4jJuqE.js";import{P as F}from"./plus-BKVculHu.js";import{S as L}from"./save-B7stjy7g.js";import{T as J}from"./trash-2-DqtDWR6Z.js";const O={class:"space-y-6"},z={key:0,class:"card p-6 bg-emerald-50 border-emerald-200"},Y={class:"flex items-center gap-3"},H={class:"p-2 rounded-full bg-emerald-100 text-emerald-600"},K={class:"flex items-center gap-4"},Q={class:"lg:col-span-2 space-y-6"},W={class:"card p-6"},X={class:"flex items-center justify-between mb-4"},Z={class:"space-y-4"},ee={class:"flex items-start gap-4"},te={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},se={class:"form-group"},ae=["onUpdate:modelValue"],oe=["value"],ne={class:"form-group"},le={class:"flex gap-2"},de=["onUpdate:modelValue"],re={class:"text-sm text-text-muted self-center"},ie={class:"form-group"},ue=["onUpdate:modelValue"],ce={class:"form-group"},me=["onUpdate:modelValue"],pe=["onClick","disabled"],be={class:"card p-6"},ve={class:"space-y-6"},he={class:"card p-6"},fe={class:"space-y-2"},ge=["value"],xe={class:"font-medium text-text-primary"},ye={class:"text-xs text-text-muted"},_e={class:"card p-6"},ke={class:"space-y-3"},Ie={class:"flex justify-between"},we={class:"font-medium"},Ne={class:"flex justify-between"},Se={class:"font-medium"},Pe={class:"card p-6"},Te={class:"space-y-3"},Ve=["disabled"],$e=C({__name:"StokPenerimaanPage",setup(qe){const k=R(),p=x(!1),I=x(!1),o=x({warehouseId:"",notes:"",items:[{productId:"",quantity:0,batchNumber:"",expiredDate:""}]}),w=E(()=>v.filter(n=>n.status==="aktif").map(n=>({value:n.id,label:`${n.name} (${n.sku})`,unit:n.unit}))),V=()=>{const n=new Date,t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),l=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`GR-${t}${a}-${l}`},q=()=>{o.value.items.push({productId:"",quantity:0,batchNumber:"",expiredDate:""})},D=n=>{o.value.items.length>1&&o.value.items.splice(n,1)},N=n=>w.value.find(t=>t.value===Number(n)),S=()=>{k.back()},M=async()=>{if(!o.value.warehouseId){alert("Mohon pilih gudang tujuan");return}const n=o.value.items.filter(t=>t.productId&&t.quantity>0);if(n.length===0){alert("Mohon tambahkan minimal 1 item");return}p.value=!0;try{await new Promise(t=>setTimeout(t,500)),n.forEach(t=>{const a=V();T.unshift({id:T.length+1,type:"penerimaan",referenceNumber:a,productId:Number(t.productId),productName:v.find(s=>s.id===Number(t.productId))?.name||"",productSku:v.find(s=>s.id===Number(t.productId))?.sku||"",warehouseTo:Number(o.value.warehouseId),warehouseNameTo:y.find(s=>s.id===Number(o.value.warehouseId))?.name||"",quantity:t.quantity,unit:N(t.productId)?.unit||"PCS",status:"completed",notes:o.value.notes,createdBy:"Admin Gudang",createdAt:new Date().toISOString()});const l=_.find(s=>s.productId===Number(t.productId)&&s.warehouseId===Number(o.value.warehouseId));if(l)l.quantity+=t.quantity;else{const s=v.find(h=>h.id===Number(t.productId));s&&_.push({id:_.length+1,productId:Number(t.productId),productName:s.name,productSku:s.sku,warehouseId:Number(o.value.warehouseId),warehouseName:y.find(h=>h.id===Number(o.value.warehouseId))?.name||"",quantity:t.quantity,minStock:50,maxStock:500,unit:s.unit,batchNumber:t.batchNumber||void 0,expiredDate:t.expiredDate||void 0})}}),I.value=!0,setTimeout(()=>{k.push({name:"stok"})},1500)}catch(t){console.error("Error saving:",t)}finally{p.value=!1}};return(n,t)=>(r(),d("div",O,[I.value?(r(),d("div",z,[e("div",Y,[e("div",H,[m(u(U),{class:"w-6 h-6"})]),t[2]||(t[2]=e("div",null,[e("p",{class:"font-semibold text-emerald-800"},"Penerimaan Berhasil!"),e("p",{class:"text-sm text-emerald-600"},"Data penerimaan barang telah disimpan")],-1))])])):B("",!0),e("div",K,[e("button",{onClick:S,class:"btn-icon btn-ghost"},[m(u(G),{class:"w-5 h-5"})]),t[3]||(t[3]=e("div",null,[e("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Penerimaan Barang"),e("p",{class:"text-text-secondary mt-1"},"Catat penerimaan barang ke gudang (Goods Receipt)")],-1))]),e("form",{onSubmit:j(M,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[e("div",Q,[e("div",W,[e("div",X,[t[5]||(t[5]=e("h2",{class:"font-semibold text-text-primary"},"Item Penerimaan",-1)),e("button",{type:"button",onClick:q,class:"btn-outline btn-sm"},[m(u(F),{class:"w-4 h-4"}),t[4]||(t[4]=P(" Tambah Item ",-1))])]),e("div",Z,[(r(!0),d(f,null,g(o.value.items,(a,l)=>(r(),d("div",{key:l,class:"p-4 bg-background-tertiary rounded-lg"},[e("div",ee,[e("div",te,[e("div",se,[t[7]||(t[7]=e("label",{class:"label"},"Produk",-1)),c(e("select",{"onUpdate:modelValue":s=>a.productId=s,class:"select"},[t[6]||(t[6]=e("option",{value:""},"Pilih Produk",-1)),(r(!0),d(f,null,g(w.value,s=>(r(),d("option",{key:s.value,value:s.value},i(s.label),9,oe))),128))],8,ae),[[$,a.productId]])]),e("div",ne,[t[8]||(t[8]=e("label",{class:"label"},"Jumlah",-1)),e("div",le,[c(e("input",{"onUpdate:modelValue":s=>a.quantity=s,type:"number",min:"1",class:"input",placeholder:"0"},null,8,de),[[b,a.quantity,void 0,{number:!0}]]),e("span",re,i(N(a.productId)?.unit||"unit"),1)])]),e("div",ie,[t[9]||(t[9]=e("label",{class:"label"},"Nomor Batch",-1)),c(e("input",{"onUpdate:modelValue":s=>a.batchNumber=s,type:"text",class:"input",placeholder:"Opsional"},null,8,ue),[[b,a.batchNumber]])]),e("div",ce,[t[10]||(t[10]=e("label",{class:"label"},"Tanggal Expired",-1)),c(e("input",{"onUpdate:modelValue":s=>a.expiredDate=s,type:"date",class:"input"},null,8,me),[[b,a.expiredDate]])])]),e("button",{type:"button",onClick:s=>D(l),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50"},[m(u(J),{class:"w-4 h-4"})],8,pe)])]))),128))])]),e("div",be,[t[11]||(t[11]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),c(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.notes=a),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[b,o.value.notes]])])]),e("div",ve,[e("div",he,[t[12]||(t[12]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Gudang Tujuan",-1)),e("div",fe,[(r(!0),d(f,null,g(u(y),a=>(r(),d("label",{key:a.id,class:"flex items-center gap-3 p-3 rounded-lg border border-border cursor-pointer hover:bg-slate-50"},[c(e("input",{type:"radio",value:a.id,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.warehouseId=l),class:"radio"},null,8,ge),[[A,o.value.warehouseId]]),e("div",null,[e("p",xe,i(a.name),1),e("p",ye,i(a.location),1)])]))),128))])]),e("div",_e,[t[15]||(t[15]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),e("div",ke,[e("div",Ie,[t[13]||(t[13]=e("span",{class:"text-text-secondary"},"Total Item",-1)),e("span",we,i(o.value.items.filter(a=>a.productId&&a.quantity>0).length),1)]),e("div",Ne,[t[14]||(t[14]=e("span",{class:"text-text-secondary"},"Total Jumlah",-1)),e("span",Se,i(o.value.items.reduce((a,l)=>a+(l.quantity||0),0)),1)])])]),e("div",Pe,[e("div",Te,[e("button",{type:"submit",disabled:p.value,class:"btn-primary w-full"},[m(u(L),{class:"w-4 h-4"}),P(" "+i(p.value?"Menyimpan...":"Simpan Penerimaan"),1)],8,Ve),e("button",{type:"button",onClick:S,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{$e as default};
