import{d as $,B as A,a as l,b as t,p as m,j as c,T as U,f as S,x as N,F as f,s as g,g as b,v as q,t as u,w as j,r as y,k as D,A as F,G,m as R,o as d}from"./index-CUmndf2P.js";import{m as E}from"./barang-CFxOeyqE.js";import{w as P,m as x,a as T}from"./stok-o4hf6QBl.js";import{A as L}from"./arrow-left-Cpmr9AlM.js";import{P as J}from"./plus-BEll3Vn4.js";import{S as O}from"./save-B4hMgu_F.js";import{T as Y}from"./trash-2-BAvBQP-f.js";const z={class:"space-y-6"},H={key:0,class:"card p-6 bg-emerald-50 border-emerald-200"},K={class:"flex items-center gap-3"},Q={class:"p-2 rounded-full bg-emerald-100 text-emerald-600"},W={class:"flex items-center gap-4"},X={class:"lg:col-span-2 space-y-6"},Z={class:"card p-6"},tt={class:"flex items-center justify-between mb-4"},et={class:"space-y-4"},st={class:"flex items-start gap-4"},at={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"form-group"},nt=["onUpdate:modelValue"],rt=["value"],lt={class:"form-group"},dt={class:"flex gap-2"},ut=["onUpdate:modelValue","max"],it={class:"text-sm text-text-muted self-center"},ct={key:0,class:"text-xs text-text-muted mt-1"},mt=["onClick","disabled"],pt={class:"card p-6"},vt={class:"space-y-6"},bt={class:"card p-6"},ht={class:"space-y-2"},ft=["value"],gt={class:"font-medium text-text-primary"},yt={class:"text-xs text-text-muted"},xt={class:"card p-6"},_t={class:"space-y-3"},It={class:"flex justify-between"},kt={class:"font-medium"},wt={class:"flex justify-between"},St={class:"font-medium"},Nt={class:"card p-6"},qt={class:"space-y-3"},Pt=["disabled"],jt=$({__name:"StokPengeluaranPage",setup(Tt){const _=D(),p=A(),v=y(!1),I=y(!1),o=y({warehouseId:"",notes:"",items:[{productId:"",quantity:0}]}),k=R(()=>x.filter(a=>!o.value.warehouseId||a.warehouseId===Number(o.value.warehouseId)).map(a=>({value:a.productId,label:`${a.productName} (${a.productSku}) - Tersedia: ${a.quantity} ${a.unit}`,unit:a.unit,available:a.quantity,warehouseId:a.warehouseId}))),h=a=>k.value.find(e=>e.value===Number(a)),M=()=>{const a=new Date,e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`GI-${e}${s}-${n}`},C=()=>{o.value.items.push({productId:"",quantity:0})},V=a=>{o.value.items.length>1&&o.value.items.splice(a,1)},w=()=>{_.back()},B=async()=>{if(!o.value.warehouseId){p.error("Mohon pilih gudang asal");return}const a=o.value.items.filter(e=>e.productId&&e.quantity>0);if(a.length===0){p.error("Mohon tambahkan minimal 1 item");return}for(const e of a){const s=x.find(n=>n.productId===Number(e.productId)&&n.warehouseId===Number(o.value.warehouseId));if(!s||s.quantity<e.quantity){p.warning("Stok tidak mencukupi untuk produk yang dipilih");return}}v.value=!0;try{await new Promise(e=>setTimeout(e,500)),a.forEach(e=>{const s=M(),n=E.find(i=>i.id===Number(e.productId));T.unshift({id:T.length+1,type:"pengeluaran",referenceNumber:s,productId:Number(e.productId),productName:n?.name||"",productSku:n?.sku||"",warehouseFrom:Number(o.value.warehouseId),warehouseNameFrom:P.find(i=>i.id===Number(o.value.warehouseId))?.name||"",quantity:e.quantity,unit:n?.unit||"PCS",status:"completed",notes:o.value.notes,createdBy:"Admin Gudang",createdAt:new Date().toISOString()});const r=x.find(i=>i.productId===Number(e.productId)&&i.warehouseId===Number(o.value.warehouseId));r&&(r.quantity-=e.quantity)}),p.success("Pengeluaran stok berhasil disimpan!"),I.value=!0,setTimeout(()=>{_.push({name:"stok"})},1500)}catch(e){console.error("Error saving:",e)}finally{v.value=!1}};return(a,e)=>(d(),l("div",z,[I.value?(d(),l("div",H,[t("div",K,[t("div",Q,[m(c(U),{class:"w-6 h-6"})]),e[2]||(e[2]=t("div",null,[t("p",{class:"font-semibold text-emerald-800"},"Pengeluaran Berhasil!"),t("p",{class:"text-sm text-emerald-600"},"Data pengeluaran barang telah disimpan")],-1))])])):S("",!0),t("div",W,[t("button",{onClick:w,class:"btn-icon btn-ghost"},[m(c(L),{class:"w-5 h-5"})]),e[3]||(e[3]=t("div",null,[t("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Pengeluaran Barang"),t("p",{class:"text-text-secondary mt-1"},"Catat pengeluaran barang dari gudang (Goods Issue)")],-1))]),t("form",{onSubmit:j(B,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[t("div",X,[t("div",Z,[t("div",tt,[e[5]||(e[5]=t("h2",{class:"font-semibold text-text-primary"},"Item Pengeluaran",-1)),t("button",{type:"button",onClick:C,class:"btn-outline btn-sm"},[m(c(J),{class:"w-4 h-4"}),e[4]||(e[4]=N(" Tambah Item ",-1))])]),t("div",et,[(d(!0),l(f,null,g(o.value.items,(s,n)=>(d(),l("div",{key:n,class:"p-4 bg-background-tertiary rounded-lg"},[t("div",st,[t("div",at,[t("div",ot,[e[7]||(e[7]=t("label",{class:"label"},"Produk",-1)),b(t("select",{"onUpdate:modelValue":r=>s.productId=r,class:"select"},[e[6]||(e[6]=t("option",{value:""},"Pilih Produk",-1)),(d(!0),l(f,null,g(k.value,r=>(d(),l("option",{key:r.value,value:r.value},u(r.label),9,rt))),128))],8,nt),[[F,s.productId]])]),t("div",lt,[e[8]||(e[8]=t("label",{class:"label"},"Jumlah",-1)),t("div",dt,[b(t("input",{"onUpdate:modelValue":r=>s.quantity=r,type:"number",min:"1",max:h(s.productId)?.available||0,class:"input",placeholder:"0"},null,8,ut),[[q,s.quantity,void 0,{number:!0}]]),t("span",it,u(h(s.productId)?.unit||"unit"),1)]),s.productId?(d(),l("p",ct," Tersedia: "+u(h(s.productId)?.available||0),1)):S("",!0)])]),t("button",{type:"button",onClick:r=>V(n),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50"},[m(c(Y),{class:"w-4 h-4"})],8,mt)])]))),128))])]),t("div",pt,[e[9]||(e[9]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),b(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.notes=s),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[q,o.value.notes]])])]),t("div",vt,[t("div",bt,[e[10]||(e[10]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Gudang Asal",-1)),t("div",ht,[(d(!0),l(f,null,g(c(P),s=>(d(),l("label",{key:s.id,class:"flex items-center gap-3 p-3 rounded-lg border border-border cursor-pointer hover:bg-slate-50"},[b(t("input",{type:"radio",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.warehouseId=n),class:"radio"},null,8,ft),[[G,o.value.warehouseId]]),t("div",null,[t("p",gt,u(s.name),1),t("p",yt,u(s.location),1)])]))),128))])]),t("div",xt,[e[13]||(e[13]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),t("div",_t,[t("div",It,[e[11]||(e[11]=t("span",{class:"text-text-secondary"},"Total Item",-1)),t("span",kt,u(o.value.items.filter(s=>s.productId&&s.quantity>0).length),1)]),t("div",wt,[e[12]||(e[12]=t("span",{class:"text-text-secondary"},"Total Jumlah",-1)),t("span",St,u(o.value.items.reduce((s,n)=>s+(n.quantity||0),0)),1)])])]),t("div",Nt,[t("div",qt,[t("button",{type:"submit",disabled:v.value,class:"btn-primary w-full"},[m(c(O),{class:"w-4 h-4"}),N(" "+u(v.value?"Menyimpan...":"Simpan Pengeluaran"),1)],8,Pt),t("button",{type:"button",onClick:w,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{jt as default};
