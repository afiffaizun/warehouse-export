import{d as B,a as r,b as t,p as m,j as c,T as $,f as w,x as S,F as h,s as f,g as v,v as N,t as u,w as A,r as g,k as D,z as U,D as j,m as F,o as d}from"./index-BdnMpLST.js";import{m as G}from"./barang-CFxOeyqE.js";import{w as q,m as y,a as P}from"./stok-o4hf6QBl.js";import{A as R}from"./arrow-left-DhbJNi4F.js";import{P as E}from"./plus-CUGrAXEY.js";import{S as L}from"./save-C-yZ_t_t.js";import{T as J}from"./trash-2-Cm-bTiFp.js";const z={class:"space-y-6"},O={key:0,class:"card p-6 bg-emerald-50 border-emerald-200"},Y={class:"flex items-center gap-3"},H={class:"p-2 rounded-full bg-emerald-100 text-emerald-600"},K={class:"flex items-center gap-4"},Q={class:"lg:col-span-2 space-y-6"},W={class:"card p-6"},X={class:"flex items-center justify-between mb-4"},Z={class:"space-y-4"},tt={class:"flex items-start gap-4"},et={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},st={class:"form-group"},at=["onUpdate:modelValue"],ot=["value"],nt={class:"form-group"},lt={class:"flex gap-2"},rt=["onUpdate:modelValue","max"],dt={class:"text-sm text-text-muted self-center"},ut={key:0,class:"text-xs text-text-muted mt-1"},it=["onClick","disabled"],ct={class:"card p-6"},mt={class:"space-y-6"},pt={class:"card p-6"},vt={class:"space-y-2"},bt=["value"],ht={class:"font-medium text-text-primary"},ft={class:"text-xs text-text-muted"},gt={class:"card p-6"},yt={class:"space-y-3"},xt={class:"flex justify-between"},_t={class:"font-medium"},It={class:"flex justify-between"},kt={class:"font-medium"},wt={class:"card p-6"},St={class:"space-y-3"},Nt=["disabled"],At=B({__name:"StokPengeluaranPage",setup(qt){const x=D(),p=g(!1),_=g(!1),o=g({warehouseId:"",notes:"",items:[{productId:"",quantity:0}]}),I=F(()=>y.filter(a=>!o.value.warehouseId||a.warehouseId===Number(o.value.warehouseId)).map(a=>({value:a.productId,label:`${a.productName} (${a.productSku}) - Tersedia: ${a.quantity} ${a.unit}`,unit:a.unit,available:a.quantity,warehouseId:a.warehouseId}))),b=a=>I.value.find(e=>e.value===Number(a)),T=()=>{const a=new Date,e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`GI-${e}${s}-${n}`},M=()=>{o.value.items.push({productId:"",quantity:0})},C=a=>{o.value.items.length>1&&o.value.items.splice(a,1)},k=()=>{x.back()},V=async()=>{if(!o.value.warehouseId){alert("Mohon pilih gudang asal");return}const a=o.value.items.filter(e=>e.productId&&e.quantity>0);if(a.length===0){alert("Mohon tambahkan minimal 1 item");return}for(const e of a){const s=y.find(n=>n.productId===Number(e.productId)&&n.warehouseId===Number(o.value.warehouseId));if(!s||s.quantity<e.quantity){alert("Stok tidak mencukupi untuk produk yang dipilih");return}}p.value=!0;try{await new Promise(e=>setTimeout(e,500)),a.forEach(e=>{const s=T(),n=G.find(i=>i.id===Number(e.productId));P.unshift({id:P.length+1,type:"pengeluaran",referenceNumber:s,productId:Number(e.productId),productName:n?.name||"",productSku:n?.sku||"",warehouseFrom:Number(o.value.warehouseId),warehouseNameFrom:q.find(i=>i.id===Number(o.value.warehouseId))?.name||"",quantity:e.quantity,unit:n?.unit||"PCS",status:"completed",notes:o.value.notes,createdBy:"Admin Gudang",createdAt:new Date().toISOString()});const l=y.find(i=>i.productId===Number(e.productId)&&i.warehouseId===Number(o.value.warehouseId));l&&(l.quantity-=e.quantity)}),_.value=!0,setTimeout(()=>{x.push({name:"stok"})},1500)}catch(e){console.error("Error saving:",e)}finally{p.value=!1}};return(a,e)=>(d(),r("div",z,[_.value?(d(),r("div",O,[t("div",Y,[t("div",H,[m(c($),{class:"w-6 h-6"})]),e[2]||(e[2]=t("div",null,[t("p",{class:"font-semibold text-emerald-800"},"Pengeluaran Berhasil!"),t("p",{class:"text-sm text-emerald-600"},"Data pengeluaran barang telah disimpan")],-1))])])):w("",!0),t("div",K,[t("button",{onClick:k,class:"btn-icon btn-ghost"},[m(c(R),{class:"w-5 h-5"})]),e[3]||(e[3]=t("div",null,[t("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Pengeluaran Barang"),t("p",{class:"text-text-secondary mt-1"},"Catat pengeluaran barang dari gudang (Goods Issue)")],-1))]),t("form",{onSubmit:A(V,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[t("div",Q,[t("div",W,[t("div",X,[e[5]||(e[5]=t("h2",{class:"font-semibold text-text-primary"},"Item Pengeluaran",-1)),t("button",{type:"button",onClick:M,class:"btn-outline btn-sm"},[m(c(E),{class:"w-4 h-4"}),e[4]||(e[4]=S(" Tambah Item ",-1))])]),t("div",Z,[(d(!0),r(h,null,f(o.value.items,(s,n)=>(d(),r("div",{key:n,class:"p-4 bg-background-tertiary rounded-lg"},[t("div",tt,[t("div",et,[t("div",st,[e[7]||(e[7]=t("label",{class:"label"},"Produk",-1)),v(t("select",{"onUpdate:modelValue":l=>s.productId=l,class:"select"},[e[6]||(e[6]=t("option",{value:""},"Pilih Produk",-1)),(d(!0),r(h,null,f(I.value,l=>(d(),r("option",{key:l.value,value:l.value},u(l.label),9,ot))),128))],8,at),[[U,s.productId]])]),t("div",nt,[e[8]||(e[8]=t("label",{class:"label"},"Jumlah",-1)),t("div",lt,[v(t("input",{"onUpdate:modelValue":l=>s.quantity=l,type:"number",min:"1",max:b(s.productId)?.available||0,class:"input",placeholder:"0"},null,8,rt),[[N,s.quantity,void 0,{number:!0}]]),t("span",dt,u(b(s.productId)?.unit||"unit"),1)]),s.productId?(d(),r("p",ut," Tersedia: "+u(b(s.productId)?.available||0),1)):w("",!0)])]),t("button",{type:"button",onClick:l=>C(n),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50"},[m(c(J),{class:"w-4 h-4"})],8,it)])]))),128))])]),t("div",ct,[e[9]||(e[9]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),v(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.notes=s),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[N,o.value.notes]])])]),t("div",mt,[t("div",pt,[e[10]||(e[10]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Gudang Asal",-1)),t("div",vt,[(d(!0),r(h,null,f(c(q),s=>(d(),r("label",{key:s.id,class:"flex items-center gap-3 p-3 rounded-lg border border-border cursor-pointer hover:bg-slate-50"},[v(t("input",{type:"radio",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.warehouseId=n),class:"radio"},null,8,bt),[[j,o.value.warehouseId]]),t("div",null,[t("p",ht,u(s.name),1),t("p",ft,u(s.location),1)])]))),128))])]),t("div",gt,[e[13]||(e[13]=t("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),t("div",yt,[t("div",xt,[e[11]||(e[11]=t("span",{class:"text-text-secondary"},"Total Item",-1)),t("span",_t,u(o.value.items.filter(s=>s.productId&&s.quantity>0).length),1)]),t("div",It,[e[12]||(e[12]=t("span",{class:"text-text-secondary"},"Total Jumlah",-1)),t("span",kt,u(o.value.items.reduce((s,n)=>s+(n.quantity||0),0)),1)])])]),t("div",wt,[t("div",St,[t("button",{type:"submit",disabled:p.value,class:"btn-primary w-full"},[m(c(L),{class:"w-4 h-4"}),S(" "+u(p.value?"Menyimpan...":"Simpan Pengeluaran"),1)],8,Nt),t("button",{type:"button",onClick:k,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{At as default};
