import{d as C,B as U,a as r,b as e,p as m,j as u,P as j,f as R,x as T,F as g,s as x,g as c,v as b,t as i,w as $,r as y,k as A,A as G,G as E,m as F,o as d}from"./index-CUmndf2P.js";import{m as v}from"./barang-CFxOeyqE.js";import{w as _,a as V,m as k}from"./stok-o4hf6QBl.js";import{A as L}from"./arrow-left-Cpmr9AlM.js";import{P as J}from"./plus-BEll3Vn4.js";import{S as O}from"./save-B4hMgu_F.js";import{T as Y}from"./trash-2-BAvBQP-f.js";const z={class:"space-y-6"},H={key:0,class:"card p-6 bg-emerald-50 border-emerald-200"},K={class:"flex items-center gap-3"},Q={class:"p-2 rounded-full bg-emerald-100 text-emerald-600"},W={class:"flex items-center gap-4"},X={class:"lg:col-span-2 space-y-6"},Z={class:"card p-6"},ee={class:"flex items-center justify-between mb-4"},te={class:"space-y-4"},se={class:"flex items-start gap-4"},ae={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"form-group"},ne=["onUpdate:modelValue"],le=["value"],re={class:"form-group"},de={class:"flex gap-2"},ie=["onUpdate:modelValue"],ue={class:"text-sm text-text-muted self-center"},ce={class:"form-group"},me=["onUpdate:modelValue"],pe={class:"form-group"},be=["onUpdate:modelValue"],ve=["onClick","disabled"],he={class:"card p-6"},fe={class:"space-y-6"},ge={class:"card p-6"},xe={class:"space-y-2"},ye=["value"],_e={class:"font-medium text-text-primary"},ke={class:"text-xs text-text-muted"},Ie={class:"card p-6"},we={class:"space-y-3"},Ne={class:"flex justify-between"},Se={class:"font-medium"},Pe={class:"flex justify-between"},Te={class:"font-medium"},Ve={class:"card p-6"},qe={class:"space-y-3"},De=["disabled"],Ge=C({__name:"StokPenerimaanPage",setup(Me){const I=A(),h=U(),p=y(!1),w=y(!1),o=y({warehouseId:"",notes:"",items:[{productId:"",quantity:0,batchNumber:"",expiredDate:""}]}),N=F(()=>v.filter(n=>n.status==="aktif").map(n=>({value:n.id,label:`${n.name} (${n.sku})`,unit:n.unit}))),q=()=>{const n=new Date,t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),l=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`GR-${t}${a}-${l}`},D=()=>{o.value.items.push({productId:"",quantity:0,batchNumber:"",expiredDate:""})},M=n=>{o.value.items.length>1&&o.value.items.splice(n,1)},S=n=>N.value.find(t=>t.value===Number(n)),P=()=>{I.back()},B=async()=>{if(!o.value.warehouseId){h.error("Mohon pilih gudang tujuan");return}const n=o.value.items.filter(t=>t.productId&&t.quantity>0);if(n.length===0){h.error("Mohon tambahkan minimal 1 item");return}p.value=!0;try{await new Promise(t=>setTimeout(t,500)),n.forEach(t=>{const a=q();V.unshift({id:V.length+1,type:"penerimaan",referenceNumber:a,productId:Number(t.productId),productName:v.find(s=>s.id===Number(t.productId))?.name||"",productSku:v.find(s=>s.id===Number(t.productId))?.sku||"",warehouseTo:Number(o.value.warehouseId),warehouseNameTo:_.find(s=>s.id===Number(o.value.warehouseId))?.name||"",quantity:t.quantity,unit:S(t.productId)?.unit||"PCS",status:"completed",notes:o.value.notes,createdBy:"Admin Gudang",createdAt:new Date().toISOString()});const l=k.find(s=>s.productId===Number(t.productId)&&s.warehouseId===Number(o.value.warehouseId));if(l)l.quantity+=t.quantity;else{const s=v.find(f=>f.id===Number(t.productId));s&&k.push({id:k.length+1,productId:Number(t.productId),productName:s.name,productSku:s.sku,warehouseId:Number(o.value.warehouseId),warehouseName:_.find(f=>f.id===Number(o.value.warehouseId))?.name||"",quantity:t.quantity,minStock:50,maxStock:500,unit:s.unit,batchNumber:t.batchNumber||void 0,expiredDate:t.expiredDate||void 0})}}),h.success("Penerimaan stok berhasil disimpan!"),w.value=!0,setTimeout(()=>{I.push({name:"stok"})},1500)}catch(t){console.error("Error saving:",t)}finally{p.value=!1}};return(n,t)=>(d(),r("div",z,[w.value?(d(),r("div",H,[e("div",K,[e("div",Q,[m(u(j),{class:"w-6 h-6"})]),t[2]||(t[2]=e("div",null,[e("p",{class:"font-semibold text-emerald-800"},"Penerimaan Berhasil!"),e("p",{class:"text-sm text-emerald-600"},"Data penerimaan barang telah disimpan")],-1))])])):R("",!0),e("div",W,[e("button",{onClick:P,class:"btn-icon btn-ghost"},[m(u(L),{class:"w-5 h-5"})]),t[3]||(t[3]=e("div",null,[e("h1",{class:"text-2xl font-display font-bold text-text-primary"},"Penerimaan Barang"),e("p",{class:"text-text-secondary mt-1"},"Catat penerimaan barang ke gudang (Goods Receipt)")],-1))]),e("form",{onSubmit:$(B,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[e("div",X,[e("div",Z,[e("div",ee,[t[5]||(t[5]=e("h2",{class:"font-semibold text-text-primary"},"Item Penerimaan",-1)),e("button",{type:"button",onClick:D,class:"btn-outline btn-sm"},[m(u(J),{class:"w-4 h-4"}),t[4]||(t[4]=T(" Tambah Item ",-1))])]),e("div",te,[(d(!0),r(g,null,x(o.value.items,(a,l)=>(d(),r("div",{key:l,class:"p-4 bg-background-tertiary rounded-lg"},[e("div",se,[e("div",ae,[e("div",oe,[t[7]||(t[7]=e("label",{class:"label"},"Produk",-1)),c(e("select",{"onUpdate:modelValue":s=>a.productId=s,class:"select"},[t[6]||(t[6]=e("option",{value:""},"Pilih Produk",-1)),(d(!0),r(g,null,x(N.value,s=>(d(),r("option",{key:s.value,value:s.value},i(s.label),9,le))),128))],8,ne),[[G,a.productId]])]),e("div",re,[t[8]||(t[8]=e("label",{class:"label"},"Jumlah",-1)),e("div",de,[c(e("input",{"onUpdate:modelValue":s=>a.quantity=s,type:"number",min:"1",class:"input",placeholder:"0"},null,8,ie),[[b,a.quantity,void 0,{number:!0}]]),e("span",ue,i(S(a.productId)?.unit||"unit"),1)])]),e("div",ce,[t[9]||(t[9]=e("label",{class:"label"},"Nomor Batch",-1)),c(e("input",{"onUpdate:modelValue":s=>a.batchNumber=s,type:"text",class:"input",placeholder:"Opsional"},null,8,me),[[b,a.batchNumber]])]),e("div",pe,[t[10]||(t[10]=e("label",{class:"label"},"Tanggal Expired",-1)),c(e("input",{"onUpdate:modelValue":s=>a.expiredDate=s,type:"date",class:"input"},null,8,be),[[b,a.expiredDate]])])]),e("button",{type:"button",onClick:s=>M(l),disabled:o.value.items.length===1,class:"btn-icon btn-ghost text-accent-danger hover:bg-red-50 disabled:opacity-50"},[m(u(Y),{class:"w-4 h-4"})],8,ve)])]))),128))])]),e("div",he,[t[11]||(t[11]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Catatan",-1)),c(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.notes=a),class:"textarea",rows:"3",placeholder:"Tambahkan catatan jika diperlukan..."},null,512),[[b,o.value.notes]])])]),e("div",fe,[e("div",ge,[t[12]||(t[12]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Gudang Tujuan",-1)),e("div",xe,[(d(!0),r(g,null,x(u(_),a=>(d(),r("label",{key:a.id,class:"flex items-center gap-3 p-3 rounded-lg border border-border cursor-pointer hover:bg-slate-50"},[c(e("input",{type:"radio",value:a.id,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.warehouseId=l),class:"radio"},null,8,ye),[[E,o.value.warehouseId]]),e("div",null,[e("p",_e,i(a.name),1),e("p",ke,i(a.location),1)])]))),128))])]),e("div",Ie,[t[15]||(t[15]=e("h2",{class:"font-semibold text-text-primary mb-4"},"Ringkasan",-1)),e("div",we,[e("div",Ne,[t[13]||(t[13]=e("span",{class:"text-text-secondary"},"Total Item",-1)),e("span",Se,i(o.value.items.filter(a=>a.productId&&a.quantity>0).length),1)]),e("div",Pe,[t[14]||(t[14]=e("span",{class:"text-text-secondary"},"Total Jumlah",-1)),e("span",Te,i(o.value.items.reduce((a,l)=>a+(l.quantity||0),0)),1)])])]),e("div",Ve,[e("div",qe,[e("button",{type:"submit",disabled:p.value,class:"btn-primary w-full"},[m(u(O),{class:"w-4 h-4"}),T(" "+i(p.value?"Menyimpan...":"Simpan Penerimaan"),1)],8,De),e("button",{type:"button",onClick:P,class:"btn-outline w-full"}," Batal ")])])])],32)]))}});export{Ge as default};
